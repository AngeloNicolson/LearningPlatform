# Debating Platform - Mathematical Tutoring & Education

A modern platform for mathematical tutoring and debating with secure authentication, payment processing, and enterprise-grade security.

## ğŸ—ï¸ Architecture

- **Client**: React + TypeScript + Vite (HTTPS enabled)
- **API**: Express.js REST API with JWT authentication
- **Database**: PostgreSQL with automated migrations
- **Shared**: Common TypeScript types and interfaces
- **Security**: HTTPS, JWT tokens, secure cookies, rate limiting

## ğŸš€ Quick Start (Recommended: Docker)

### Prerequisites

- Docker and Docker Compose
- mkcert (for HTTPS certificates)
- Git

### Setup with Docker (Easiest)

1. **Clone and navigate to project**:
   ```bash
   git clone <repository-url>
   cd Debating-platform
   ```

2. **Install mkcert** (one-time setup):
   ```bash
   # macOS
   brew install mkcert

   # Linux (Ubuntu/Debian)
   sudo apt install libnss3-tools
   wget https://github.com/FiloSottile/mkcert/releases/download/v1.4.4/mkcert-v1.4.4-linux-amd64
   chmod +x mkcert-v1.4.4-linux-amd64
   sudo mv mkcert-v1.4.4-linux-amd64 /usr/local/bin/mkcert
   ```

3. **Generate HTTPS certificates** (Required for secure authentication):
   ```bash
   npm run setup:https
   ```
   This creates certificates in the `certs/` directory.

4. **Start all services with Docker**:
   ```bash
   docker compose up
   ```

   This will:
   - Build the client and API containers
   - Start PostgreSQL database
   - **Automatically run all database migrations**
   - Start Redis for session management
   - Mount HTTPS certificates

5. **Access the application**:
   - Frontend: https://localhost:5777
   - API: https://localhost:3777
   - Database: PostgreSQL on localhost:5432

   **Test Accounts**:
   - Owner: owner@example.com / Owner123!
   - Admin: admin@example.com / Admin123!
   - Teacher: teacher@example.com / Teacher123!
   - Student: student@example.com / Student123!

### Docker Commands

```bash
# Start services (builds if needed)
npm run docker:up
# or
docker compose up

# Start in detached mode
docker compose up -d

# View logs
docker compose logs -f
docker compose logs -f api      # API logs only
docker compose logs -f client   # Client logs only

# Stop services (keeps data)
docker compose down

# Stop and remove all data
docker compose down -v

# Rebuild from scratch
npm run docker:rebuild
# or
docker compose down -v && docker compose build --no-cache && docker compose up

# Check status
npm run docker:status
```

## ğŸ› ï¸ Local Development (Without Docker)

### Prerequisites

- Node.js 18+ and npm 9+
- PostgreSQL 15+
- mkcert (for HTTPS setup)

### Setup

1. **Install dependencies**:
   ```bash
   npm install
   ```

2. **Generate HTTPS certificates**:
   ```bash
   npm run setup:https
   ```

3. **Set up PostgreSQL database**:
   - Create a database named `tutoring_platform`
   - Run migrations from `api/src/database/migrations/` in order (001_schema.sql, 002_seed_tutors.sql, etc.)

4. **Start development servers**:
   ```bash
   npm run dev
   ```
   This runs both the client and API concurrently.

5. **Access the application**:
   - Frontend: https://localhost:5777
   - API: https://localhost:3777

## ğŸ“ Project Structure

```
â”œâ”€â”€ client/                  # React frontend (HTTPS)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/     # UI components
â”‚   â”‚   â”œâ”€â”€ contexts/       # React contexts
â”‚   â”‚   â”œâ”€â”€ pages/          # Page components
â”‚   â”‚   â””â”€â”€ services/       # API client
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ api/                     # Express REST API
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ routes/         # API endpoints
â”‚   â”‚   â”œâ”€â”€ middleware/     # Auth & security
â”‚   â”‚   â””â”€â”€ database/
â”‚   â”‚       â””â”€â”€ migrations/ # SQL migration files (auto-run in Docker)
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ shared/                  # Shared TypeScript types
â”‚   â””â”€â”€ src/types/
â”œâ”€â”€ certs/                   # HTTPS certificates (generated by setup script)
â”‚   â”œâ”€â”€ localhost.pem
â”‚   â””â”€â”€ localhost-key.pem
â”œâ”€â”€ scripts/                 # Setup and utility scripts
â”‚   â””â”€â”€ setup-https.sh      # Certificate generation script
â”œâ”€â”€ package.json            # Root workspace config
â””â”€â”€ docker-compose.yml      # Service orchestration
```

## ğŸ”§ Features

### âœ… Current Implementation
- **HTTPS enabled** for secure connections
- **JWT authentication** with refresh token rotation
- **Secure HTTP-only cookies** for token storage
- **Mathematical tutoring** system with booking
- **Grade-based resources** (Elementary to College)
- **Stripe payment** integration ready
- **Light tofu theme** with burgundy accents
- **Docker deployment** with hot reloading

### ğŸ”’ Security Features
- Rate limiting on all endpoints
- Password hashing with bcrypt
- CSRF protection
- Security headers via Helmet.js
- Input validation and sanitization
- SQL injection prevention
- Audit logging for security events
- Account lockout after failed attempts

## ğŸ“Š API Endpoints

### Authentication
- `POST /api/auth/register` - User registration
- `POST /api/auth/login` - User login
- `POST /api/auth/refresh` - Refresh tokens
- `POST /api/auth/logout` - Logout

### Tutors
- `GET /api/tutors` - List tutors
- `GET /api/tutors/:id` - Get tutor details
- `GET /api/tutors/:id/availability` - Get availability

### Bookings
- `POST /api/bookings` - Create booking
- `GET /api/bookings/my-bookings` - User's bookings
- `DELETE /api/bookings/:id` - Cancel booking
- `POST /api/bookings/:id/confirm` - Confirm payment

### Individual Services (Local Development)
```bash
npm run dev          # Both client and API
npm run dev:client   # Frontend only (https://localhost:5777)
npm run dev:api      # API only (https://localhost:3777)
```

### Build for Production
```bash
npm run build        # Build all workspaces
npm run build:client # Build client only
npm run build:api    # Build API only
```

## ğŸ”’ Environment Variables

### API (.env in `api/` directory)
```env
NODE_ENV=development
PORT=3777
USE_HTTPS=true
CLIENT_URL=https://localhost:5777

# JWT Secrets (change in production!)
JWT_SECRET=your-jwt-secret-key-here
JWT_EXPIRES_IN=7d

# Session
SESSION_SECRET=your-session-secret-key-here

# Database (for Docker)
DB_HOST=postgres
DB_PORT=5432
DB_NAME=tutoring_platform
DB_USER=postgres
DB_PASSWORD=development
```

### Client (.env in `client/` directory - if needed)
```env
VITE_API_URL=https://localhost:3777/api
VITE_STRIPE_PUBLIC_KEY=pk_test_...
```

## ğŸ³ Docker Services

The `docker-compose.yml` includes:

- **postgres**: PostgreSQL 15 database with automatic migration execution
- **api**: Express REST API with HTTPS and JWT authentication
- **client**: React frontend with Vite and HTTPS support
- **redis**: Redis for session management (optional)

### Key Features:
- âœ… Automatic database migrations on first startup
- âœ… HTTPS certificates mounted from `certs/` directory
- âœ… Hot reloading enabled for development
- âœ… Persistent database volumes
- âœ… Health checks for PostgreSQL

## ğŸ” Authentication Flow

1. User registers/logs in via HTTPS
2. Server validates credentials
3. JWT tokens stored in secure cookies
4. Access token (15min) for API requests
5. Refresh token (7days) for renewal
6. Automatic token rotation

## ğŸ› Troubleshooting

### Certificate Issues
If you see certificate warnings in the browser:
```bash
# Install the local CA (one-time)
mkcert -install

# Regenerate certificates
npm run setup:https
```

### Vite Cache Permission Issues (Local Dev)
If you get `EACCES: permission denied` errors when starting the client:
```bash
# Remove Vite cache owned by root
sudo rm -rf client/node_modules/.vite
npm run dev
```

### Port Already in Use
If ports 3777 or 5777 are already in use:
```bash
# Kill processes on those ports
lsof -ti:3777 | xargs kill -9
lsof -ti:5777 | xargs kill -9
```

### Docker Permission Issues
If you encounter permission errors with Docker:
```bash
# Reset and rebuild
docker compose down -v
docker compose build --no-cache
docker compose up
```

### Database Migration Issues
Migrations run automatically on first Docker startup. To reset:
```bash
# Remove all volumes (deletes data!)
docker compose down -v
docker compose up
```

---

## ğŸ¯ Ready to Start?

**With Docker (Recommended):**
```bash
npm run setup:https
docker compose up
```

**Local Development:**
```bash
npm run setup:https
npm install
npm run dev
```

Then visit **https://localhost:5777** ğŸš€